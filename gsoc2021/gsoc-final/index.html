<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.8.0">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Larry Dong">

  
  
  
    
  
  <meta name="description" content="Here is a summary of my ongoing work and contributions">

  
  <link rel="alternate" hreflang="en-us" href="https://www.larrydong.com/gsoc2021/gsoc-final/">

  


  
  
  
  <meta name="theme-color" content="#2962ff">
  

  
  
  
  <script src="/js/mathjax-config.js"></script>
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0-1/css/all.min.css" integrity="sha256-4w9DunooKSr3MFXHXWyFER38WmPdm361bQS/2KUWZbU=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css" integrity="sha256-SHMGCYmST46SoyGgo4YR/9AlK1vf3ff84Aq9yK4hdqM=" crossorigin="anonymous">
    

    

    
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js" integrity="sha256-Md1qLToewPeKjfAHU1zyPwOutccPAm5tahnaw7Osw0A=" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" integrity="" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    

  

  
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap">
  

  
  
  
  
  <link rel="stylesheet" href="/css/academic.css">

  




  


  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/images/icon_hu44b46921427db89d715dc5ab7d9e224d_1776_32x32_fill_lanczos_center_2.png">
  <link rel="apple-touch-icon" type="image/png" href="/images/icon_hu44b46921427db89d715dc5ab7d9e224d_1776_192x192_fill_lanczos_center_2.png">

  <link rel="canonical" href="https://www.larrydong.com/gsoc2021/gsoc-final/">

  
  
  
  
  
    
    
  
  
  <meta property="twitter:card" content="summary">
  
  <meta property="og:site_name" content="Larry Dong">
  <meta property="og:url" content="https://www.larrydong.com/gsoc2021/gsoc-final/">
  <meta property="og:title" content="Work Product Submission | Larry Dong">
  <meta property="og:description" content="Here is a summary of my ongoing work and contributions"><meta property="og:image" content="img/map[gravatar:%!s(bool=false) shape:circle]">
  <meta property="twitter:image" content="img/map[gravatar:%!s(bool=false) shape:circle]"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2021-08-24T00:00:00&#43;00:00">
    
    <meta property="article:modified_time" content="2021-08-24T00:00:00&#43;00:00">
  

  



  


  


  





  <title>Work Product Submission | Larry Dong</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  







<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="/">Larry Dong</a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="/">Larry Dong</a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#about"><span>Home</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#gsoc2021"><span>GSoC2021</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#posts"><span>Posts</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      
      <li class="nav-item">
        <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
      </li>
      

      
      <li class="nav-item dropdown theme-dropdown">
        <a href="#" class="nav-link js-theme-selector" data-toggle="dropdown" aria-haspopup="true">
          <i class="fas fa-palette" aria-hidden="true"></i>
        </a>
        <div class="dropdown-menu">
          <a href="#" class="dropdown-item js-set-theme-light">
            <span>Light</span>
          </a>
          <a href="#" class="dropdown-item js-set-theme-dark">
            <span>Dark</span>
          </a>
          <a href="#" class="dropdown-item js-set-theme-auto">
            <span>Automatic</span>
          </a>
        </div>
      </li>
      

      

    </ul>

  </div>
</nav>


  <article class="article">

  












  

  
  
  
<div class="article-container pt-3">
  <h1>Work Product Submission</h1>

  
  <p class="page-subtitle">The End of GSoC 2021 ðŸŽˆ</p>
  

  
    


<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
    
    Aug 24, 2021
  </span>
  

  

  

  
  
  

  
  

</div>

    














  
</div>



  <div class="article-container">

    <div class="article-style">
      <p>This post effectively marks the end of my GSoC experience, but just the beginning of my project. As per the 
<a href="https://developers.google.com/open-source/gsoc/help/work-product" target="_blank" rel="noopener">Work Submission Guidelines</a>, detailed here are my contributions.</p>
<h1 id="summary">Summary</h1>
<p>The goal of my project is to build a submodule on Dirichlet Processes, a Bayesian nonparametric method for the estimation of probability distributions. I have worked on many aspects that would benefit the submodule, but <strong>no</strong> pull requests will be merged into the main branch by the end of the summer.</p>
<h1 id="1---testing">1 - Testing</h1>
<p>We spent a good portion of the summer discussing about testing for two reasons: (1) tests can serve as checks for my understanding of statistical theory and what I want my code to accomplish and (2) visual tests will ultimately turn into unit tests, which will be integrated in the CD/CI pipeline.</p>
<h3 id="1a---generating-the-right-data">1.A - Generating the right data</h3>
<p>Notebook: <a href="https://github.com/larryshamalama/pymc3-playground/blob/master/notebooks/step-by-step/test-multiple-dp-samples.ipynb">https://github.com/larryshamalama/pymc3-playground/blob/master/notebooks/step-by-step/test-multiple-dp-samples.ipynb</a>.</p>
<p>Dirichlet processes are specified by two things: a concentration parameter <code>M</code> and a base distribution <code>G0</code>. The first step was to design a visual test that can retrieve the concentration parameter. For instance, if we defined <code>G0</code> to be $\mathcal{N}(5, 3^2)$, we can attempt to retrieve the mean of <code>mu = 5</code> via the following test:</p>
<pre><code class="language-{python}">mu = 5

rng = np.random.RandomState(seed=34)
x = rng.normal(loc=2., scale=2., size=[1000,])

with pm.Model() as model:
    Âµ = pm.Normal(&quot;Âµ&quot;, mu=0., sigma=5.)
    G0 = pm.Normal(&quot;G0&quot;, mu=Âµ, sigma=2., observed=x)

    trace = pm.sample(draws=1000, chains=1)

_ = pm.plot_trace(trace)
</code></pre>
<p>and, lastly, <code>trace.to_dict()[&quot;posterior&quot;][&quot;Âµ&quot;].mean()</code> should evaluate to be close to 5. Inference on stick-breaking weights can be a tad more challenging, but it is still possible. Running the reverse stick-breaking function on weights that sum to 1, we can retrieve the concentration parameter as followed:</p>
<pre><code class="language-{python}">rng = np.random.RandomState(seed=34)
betas = rng.beta(1., 5., size=[1000, 20])
weights = stick_breaking(betas)

recovered_betas = stick_glueing(weights)

with pm.Model() as model:
    Î± = pm.Uniform(&quot;Î±&quot;, 0., 10.)
    Î² = pm.Beta(&quot;Î²&quot;, 1., Î±, shape=(20,), observed=recovered_betas)
</code></pre>
<p>The notebook linked above combines both visual tests mentioned here. While it may seem redundant to obtain <code>weights</code> from <code>betas</code> and retrieve the latter back using <code>stick_glueing</code>, the two-level sampling below uses weights estimated using empirical frequencies of observed atoms. A preliminary first step was to get the tests here correct (which took me a while&hellip;).</p>
<h5 id="precision-issues">Precision Issues</h5>
<p>Notebook: <a href="https://github.com/larryshamalama/pymc3-playground/blob/master/notebooks/shortcomings/replicate-precision-error.ipynb">https://github.com/larryshamalama/pymc3-playground/blob/master/notebooks/shortcomings/replicate-precision-error.ipynb</a></p>
<p>When generating weights, the data-generating code above is prone to producing negative weight values due to precision issues. Weights are generally decreasing in value and, especially with a small concentration parameter, floating point accuracy may be lost for the smallest weights. This is mostly fine for several reasons:</p>
<ul>
<li>The exercise here was to write tests. We can easily use a brute force solution of discarding generated weights falling out of the (0, 1) range.</li>
<li>In practice, the concentration parameter is often above 1. During posterior updating, the concentration parameter is incremented by the number of observations on which we condition on.</li>
<li>This seems to be a practical issue; warnings can be raised during API design in case sampling is prone to fail.</li>
</ul>
<h3 id="1b---two-level-sampling">1.B - Two-level sampling</h3>
<p>Notebook: <a href="https://github.com/larryshamalama/pymc3-playground/blob/master/notebooks/step-by-step/test-two-level-sampling.ipynb">https://github.com/larryshamalama/pymc3-playground/blob/master/notebooks/step-by-step/test-two-level-sampling.ipynb</a></p>
<p>While weights are generated, they are often not known in practice. However, we can estimate them empirically by sampling from the sampled distribution from a Dirichlet Process (prior or posterior).</p>
<h5 id="large-k-small-n_dp">Large <code>K</code>, small <code>N_dp</code></h5>
<p>Performing inference on the concentration parameter and base distribution parameters goes well given that all K atoms sampled from the base distribution is observed at least once in the DP sample. This is often not the case, and it shouldn&rsquo;t be because, in a Dirichlet Process Mixture, we want atoms to be unobserved such that the number of clusters can be inferred probabilistically. However, for testing purposes, this issue can be circumvented by discarding all multinomial DP samples with unobserved atoms. This phenomenon is increasing likely with larger <code>K</code> and smaller <code>N_dp</code> values.</p>
<h5 id="no-ordering">No ordering</h5>
<p>While weights are decreasing in expectation, it is important to <strong>not</strong> order them when performing the unstick-breaking process. Otherwise, our results will be biased and posterior inference would not be valid.</p>
<h1 id="2---creating-a-stickbreakingweights-randomvariable">2 - Creating a StickBreakingWeights <code>RandomVariable</code></h1>
<p>See local 
<a href="https://github.com/larryshamalama/pymc3-playground/pull/1/files" target="_blank" rel="noopener">PR</a></p>
<pre><code class="language-{python}">class StickBreakingWeightsRV(RandomVariable):
    name = &quot;stick_breaking_weights&quot;
    ndim_supp = 1
    ndims_params = [0]
    dtype = &quot;floatX&quot;
    _print_name = (&quot;Stick-Breaking weights&quot;, &quot;\\operatorname{StickBreakingWeights}&quot;)

    def __call__(self, alpha, size=None, **kwargs):
        return super().__call__(alpha, size=size, **kwargs)

    @classmethod
    def rng_fn(cls, rng, alpha, size):
        betas = rng.beta(1, alpha, size=size)
        sticks = np.concatenate(
            [
                [1],
                np.cumprod(1 - betas[:-1]),
            ]
        )

        return betas * sticks
</code></pre>
<p>The version 4 refactoring process uses a slightly different design for the <code>RandomVariable</code> class. As such, I attempt to create a class specifically for (truncated) stick-breaking weights as this will be very useful for the implementation of Dirichlet Processes. However, even with some feedback from the community, the distribution is not functional&hellip; yet!</p>
<h1 id="3---the-dirichletprocess-class-an-ongoing-effort">3 - The <code>DirichletProcess</code> class: an ongoing effort&hellip;</h1>
<p>See work-in-progress PR 
<a href="https://github.com/pymc-devs/pymc3/pull/4809#pullrequestreview-730223460" target="_blank" rel="noopener">here</a> and everything else 
<a href="https://github.com/larryshamalama/pymc3-playground" target="_blank" rel="noopener">here</a>.</p>
<p>Building a submodule for Dirichlet Processes will be an ongoing effort that I hope to accomplish in the coming months. I know that it is possible and that I can do it. However, there are still many things to learn and many challenges inherent to the statistical methodology that I have yet to face. Above all, we must come up with an intuitive API design which is completely foreign territory for me. The PR serves more to seek feedback and direction from my mentors and more experienced members of the PyMC community and my personal repository showcases my ongoing progress, no matter how small.</p>
<h3 id="final-comments">Final Comments</h3>
<p>I am extremely grateful for this enriching opportunity and the support from my mentors Austin and Chris. Being a graduate student who&rsquo;s primary goal is to understand statistical theory and do research, this experience has allowed me to strengthen my programming skills, but especially discover so many unexplored areas of software design and open source development. While my progress this summer was on the slower end, I learned a lot from my experience and I am confident that I will be able to get this submodule to work in the coming months. Stay tuned! ðŸš€</p>

    </div>

    


















  
  





  
  
  
    
  
  
  
  <div class="media author-card content-widget-hr">
    
      
      <img class="avatar mr-3 avatar-circle" src="/authors/admin/avatar_hu4f3adab5bd920ee686fee8ba19d489ce_1404168_270x270_fill_q90_lanczos_center.jpg" alt="Larry Dong">
    

    <div class="media-body">
      <h5 class="card-title"><a href="https://www.larrydong.com">Larry Dong</a></h5>
      <h6 class="card-subtitle">PhD Student in Biostatistics</h6>
      <p class="card-text">Statistics and data analysis are my strengths, but medical research is my passion.</p>
      <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
    <li>
      <a href="mailto:larry.dong@mail.utoronto.ca" >
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://twitter.com/larryshamalama" target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
    </li>
  
    
    
    
    
    
    
    
      
    
    <li>
      <a href="https://scholar.google.com/citations?user=E7_24KYAAAAJ" target="_blank" rel="noopener">
        <i class="ai ai-google-scholar"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://github.com/larryshamalama" target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://www.linkedin.com/in/larry-dong/" target="_blank" rel="noopener">
        <i class="fab fa-linkedin"></i>
      </a>
    </li>
  
</ul>

    </div>
  </div>












  
  



  </div>
</article>

      

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js" integrity="sha256-eOgo0OtLL4cdq7RdwRUiGKLX9XsIJ7nGhWEKbohmVAQ=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/r.min.js"></script>
        
      

    

    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.js" integrity="sha256-EErZamuLefUnbMBQbsEqu1USa+btR2oIlCpBJbyD4/g=" crossorigin="anonymous"></script>
    

    
    
    <script>const code_highlighting = true;</script>
    

    
    
    <script>const isSiteThemeDark = false;</script>
    

    
    
    
    
    
    
    <script>
      const search_config = {"indexURI":"/index.json","minLength":1,"threshold":0.3};
      const i18n = {"no_results":"No results found","placeholder":"Search...","results":"results found"};
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.b2ed8054531fc8b77a9c500d5dfef876.js"></script>

    






  
  
  <div class="container">
    <footer class="site-footer">
  

  <p class="powered-by">
    Â© 2021 Larry Dong &middot; 

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" class="back-to-top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
